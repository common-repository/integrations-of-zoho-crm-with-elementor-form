var V=Object.defineProperty;var A=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var M=(t,a,n)=>a in t?V(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,f=(t,a)=>{for(var n in a||(a={}))E.call(a,n)&&M(t,n,a[n]);if(A)for(var n of A(a))W.call(a,n)&&M(t,n,a[n]);return t};var S=(t,a,n)=>new Promise((l,i)=>{var s=o=>{try{d(n.next(o))}catch(u){i(u)}},e=o=>{try{d(n.throw(o))}catch(u){i(u)}},d=o=>o.done?l(o.value):Promise.resolve(o.value).then(s,e);d((n=n.apply(t,a)).next())});import{_ as h,b as k,a as J,s as P}from"./bi-910-9.js";const Q=u=>S(void 0,[u],function*({flow:t,setFlow:a,allIntegURL:n,conf:l,history:i,index:s,edit:e,setIsLoading:d,setSnackbar:o}){var g,_,y,m,z;let r="flow/save";d&&d instanceof Function&&d(!0);const p=l;t.triggered_entity==="Elementor"&&(e?p.postId=(_=(g=t==null?void 0:t.flow_details)==null?void 0:g.postId)!=null?_:null:p.postId=(m=(y=t==null?void 0:t.triggerData)==null?void 0:y.postId)!=null?m:null);const c={name:l.name,trigger:t.triggered_entity,triggered_entity_id:(z=t==null?void 0:t.triggerData)!=null&&z.formID?t.triggerData.formID:t.triggered_entity_id||0,flow_details:p};t.id&&(c.id=t.id),e&&(r="flow/update");try{yield k(c,r).then(F=>{var $;!e&&F.success&&i.push(n);let w="",R="success";($=F.data)!=null&&$.msg?w=F.data.msg:F.success?w=e?h("Integration updated successfully"):h("Integration saved successfully"):(R="error",w=e?h("Failed to update integration"):h("Failed to save integration")),J(w,{type:R}),d&&d instanceof Function&&d(!1),e||setTimeout(()=>{i.push(n)},700)})}catch(F){return d&&d instanceof Function&&d(!1),h("Failed to save integration")}}),X=t=>{const a={},l=window.location.href.replace(`${window.opener.location.href}/redirect`,"").split("&");l&&l.forEach(i=>{const s=i.split("=");s[1]&&(a[s[0]]=s[1])}),localStorage.setItem(`__${t}`,JSON.stringify(a)),window.close()},Y=(t,a,n,l,i,s,e,d,o,u)=>{if(!l.dataCenter||!l.clientId||!l.clientSecret){s({dataCenter:l.dataCenter?"":h("Data center cann't be empty"),clientId:l.clientId?"":h("Client ID cann't be empty"),clientSecret:l.clientSecret?"":h("Secret key cann't be empty")});return}d(!0);const r=`https://accounts.zoho.${l.dataCenter}/oauth/v2/auth?scope=${n}&response_type=code&client_id=${l.clientId}&prompt=Consent&access_type=offline&state=${encodeURIComponent(window.location.href)}/redirect&redirect_uri=${encodeURIComponent(`${u.api.base}`)}/redirect`,p=window.open(r,t,"width=400,height=609,toolbar=off"),c=setInterval(()=>{if(p.closed){clearInterval(c);let g={},_=!1;const y=localStorage.getItem(`__${t}`);if(y&&(_=!0,g=JSON.parse(y),localStorage.removeItem(`__${t}`)),!g.code||g.error||!g||!_){const m=g.error?`Cause: ${g.error}`:"";o({show:!0,msg:`${h("Authorization failed")} ${m}. ${h("please try again")}`}),d(!1)}else{const m=f({},l);m.accountServer=g["accounts-server"],N(a,g,m,i,e,d,o,u)}}},500)},N=(t,a,n,l,i,s,e,d)=>{const o=f({},a);o.dataCenter=n.dataCenter,o.clientId=n.clientId,o.clientSecret=n.clientSecret,o.redirectURI=`${d.api.base}/redirect`,k(o,`${t}_generate_token`).then(u=>u).then(u=>{if(u&&u.success){const r=f({},n);r.tokenDetails=u.data,l(r),i(!0),e({show:!0,msg:h("Authorized Successfully")})}else u&&u.data&&u.data.data||!u.success&&typeof u.data=="string"?e({show:!0,msg:`${h("Authorization failed Cause:")}${u.data.data||u.data}. ${h("please try again")}`}):e({show:!0,msg:h("Authorization failed. please try again")});s(!1)})},x=(t,a,n,l,i)=>{const s=f({},a);i?l?s.relatedlists[i-1].upload_field_map.splice(t,0,{}):s.relatedlists[i-1].field_map.splice(t,0,{}):l?s.upload_field_map.splice(t,0,{}):s.field_map.splice(t,0,{}),n(f({},s))},L=(t,a,n,l,i)=>{const s=f({},a);i?l?s.relatedlists[i-1].upload_field_map.length>1&&s.relatedlists[i-1].upload_field_map.splice(t,1):s.relatedlists[i-1].field_map.length>1&&s.relatedlists[i-1].field_map.splice(t,1):l?s.upload_field_map.length>1&&s.upload_field_map.splice(t,1):s.field_map.length>1&&s.field_map.splice(t,1),n(f({},s))},C=(t,a,n,l,i,s)=>{const e=f({},n);s?i?e.relatedlists[s-1].upload_field_map[a][t.target.name]=t.target.value:e.relatedlists[s-1].field_map[a][t.target.name]=t.target.value:i?e.upload_field_map[a][t.target.name]=t.target.value:e.field_map[a][t.target.name]=t.target.value,t.target.value==="custom"&&(s?e.relatedlists[s-1].field_map[a].customValue="":e.field_map[a].customValue=""),l(f({},e))},b=(t,a,n,l,i)=>{const s=f({},n);i?s.relatedlists[i-1].field_map[a].customValue=t.target.value:s.field_map[a].customValue=t.target.value,l(f({},s))},T=(t,a,n,l,i,s,e,d,o,u)=>{let r=f({},n);if(a===0){if(d){const p=f({},o);p[t.target.name]="",u(f({},p))}r[t.target.name]=t.target.value}else r.relatedlists||(r.relatedlists=[]),r.relatedlists[a-1][t.target.name]=t.target.value;switch(t.target.name){case"module":r=G(a,i,r,l,s,e);break;case"layout":r=j(a,i,r,l,s,e);break}l(f({},r))},ee=(t,a,n,l,i,s,e)=>{var d,o;t&&!((o=(d=l.default)==null?void 0:d.relatedlists)!=null&&o[l.module])&&K(n,l,i,s,e),a(t)},G=(t,a,n,l,i,s)=>{var o,u;let e=f({},n);const d=t===0?e.module:e.relatedlists[t-1].module;if(e.relatedlists[t-1]||(e.relatedlists[t-1]={}),t===0?(e.layout="",e.actions={},e.field_map=[{formField:"",zohoFormField:""}],e.upload_field_map=[{formField:"",zohoFormField:""}],e.relatedlists=[]):(e.relatedlists[t-1].layout="",e.relatedlists[t-1].actions={},e.relatedlists[t-1].field_map=[{formField:"",zohoFormField:""}],e.relatedlists[t-1].upload_field_map=[{formField:"",zohoFormField:""}]),!((o=e.default.layouts)!=null&&o[d]))H(t,a,e,l,i,s);else{const r=Object.keys((u=e.default.layouts)==null?void 0:u[d]);r.length===1&&(t===0?[e.layout]=r:[e.relatedlists[t-1].layout]=r,e=j(t,a,e,l,i,s))}return e},j=(t,a,n,l,i,s)=>{var u,r,p,c,g,_,y,m,z,F,w,R,$,q,O,U,v;const e=f({},n),d=t===0?e.module:e.relatedlists[t-1].module,o=t===0?e.layout:e.relatedlists[t-1].layout;return t===0?(e.actions={},e.field_map=(c=(p=(r=(u=e==null?void 0:e.default)==null?void 0:u.layouts)==null?void 0:r[d])==null?void 0:p[o])!=null&&c.required?D(t,e):[{formField:"",zohoFormField:""}],e.upload_field_map=(m=(y=(_=(g=e==null?void 0:e.default)==null?void 0:g.layouts)==null?void 0:_[d])==null?void 0:y[o])!=null&&m.requiredFileUploadFields&&Object.keys(e.default.layouts[d][o].requiredFileUploadFields).length>0?D(t,e,!0):[{formField:"",zohoFormField:""}]):(e.relatedlists[t-1].actions={},e.relatedlists[t-1].field_map=(R=(w=(F=(z=e==null?void 0:e.default)==null?void 0:z.layouts)==null?void 0:F[d])==null?void 0:w[o])!=null&&R.required?D(t,e):[{formField:"",zohoFormField:""}],e.relatedlists[t-1].upload_field_map=(U=(O=(q=($=e==null?void 0:e.default)==null?void 0:$.layouts)==null?void 0:q[d])==null?void 0:O[o])!=null&&U.requiredFileUploadFields&&Object.keys(e.default.layouts[d][o].requiredFileUploadFields).length>0?D(t,e,!0):[{formField:"",zohoFormField:""}]),!((v=e.default.tags)!=null&&v[d])&&I(t,a,e,l,i,s),e},te=(t,a,n,l,i)=>{l(!0);const s={formID:t,id:a.id,dataCenter:a.dataCenter,clientId:a.clientId,clientSecret:a.clientSecret,tokenDetails:a.tokenDetails};k(s,"zcrm_refresh_modules").then(e=>{if(e&&e.success){const d=f({},a);d.default||(d.default={}),e.data.modules&&(d.default.modules=e.data.modules),e.data.tokenDetails&&(d.tokenDetails=e.data.tokenDetails),n(f({},d)),i({show:!0,msg:h("Modules refreshed","bit-integrations")})}else e&&e.data&&e.data.data||!e.success&&typeof e.data=="string"?i({show:!0,msg:P(h("Modules refresh failed Cause: %s. please try again","bit-integrations"),e.data.data||e.data)}):i({show:!0,msg:h("Modules refresh failed. please try again","bit-integrations")});l(!1)}).catch(()=>l(!1))},H=(t,a,n,l,i,s)=>{const e=f({},n),d=t===0?e.module:e.relatedlists[t-1].module;if(!d)return;i(!0);const o={formID:a,module:d,dataCenter:e.dataCenter,clientId:e.clientId,clientSecret:e.clientSecret,tokenDetails:e.tokenDetails};k(o,"zcrm_refresh_layouts").then(u=>{var r,p;if(u&&u.success){if(u.data.layouts){e.default.layouts||(e.default.layouts={}),e.default.layouts[d]=u.data.layouts;const c=[...Object.keys(u.data.layouts)];c.length===1&&(t===0?([e.layout]=c,e.field_map=D(t,e),Object.keys(u.data.layouts[c].fileUploadFields).length>0&&(e.upload_field_map=D(t,e,!0))):([e.relatedlists[t-1].layout]=c,e.relatedlists[t-1].field_map=D(t,e),Object.keys(u.data.layouts[c].fileUploadFields).length>0&&(e.relatedlists[t-1].upload_field_map=D(t,e,!0))),(r=e.default.tags)!=null&&r[d]||I(t,a,e,l,i,s))}u.data.tokenDetails&&(e.tokenDetails=u.data.tokenDetails),l(f({},e)),s({show:!0,msg:h("Layouts refreshed","bit-integrations")})}else(p=u==null?void 0:u.data)!=null&&p.data||!u.success&&typeof u.data=="string"?s({show:!0,msg:P(h("Layouts refresh failed Cause: %s. please try again","bit-integrations"),u.data.data||u.data)}):s({show:!0,msg:h("Layouts refresh failed. please try again","bit-integrations")});i(!1)}).catch(()=>i(!1))},K=(t,a,n,l,i)=>{if(!a.module)return;l(!0);const s={formID:t,module:a.module,dataCenter:a.dataCenter,clientId:a.clientId,clientSecret:a.clientSecret,tokenDetails:a.tokenDetails};k(s,"zcrm_get_related_lists").then(e=>{var d;if(e&&e.success){const o=f({},a);e.data.relatedLists&&(o.default.relatedlists||(o.default.relatedlists={}),o.default.relatedlists[o.module]=f({},e.data.relatedLists)),e.data.tokenDetails&&(o.tokenDetails=e.data.tokenDetails),n(f({},o)),i({show:!0,msg:h("RelatedLists refreshed","bit-integrations")})}else(d=e==null?void 0:e.data)!=null&&d.data||!e.success&&typeof e.data=="string"?i({show:!0,msg:`${h("RelatedLists refresh failed Cause:")}${e.data.data||e.data}. ${h("please try again","bit-integrations")}`}):i({show:!0,msg:h("RelatedLists refresh failed. please try again","bit-integrations")});l(!1)}).catch(()=>l(!1))},I=(t,a,n,l,i,s)=>{const e=t===0?n.module:n.relatedlists[t-1].module;if(!e)return;i(!0);const d={formID:a,module:e,dataCenter:n.dataCenter,clientId:n.clientId,clientSecret:n.clientSecret,tokenDetails:n.tokenDetails};k(d,"zcrm_get_tags").then(o=>{var u;if(o!=null&&o.success){const r=f({},n);o.data.tags&&(r.default.tags||(r.default.tags={}),r.default.tags[e]=f({},o.data.tags)),o.data.tokenDetails&&(r.tokenDetails=o.data.tokenDetails),l(f({},r)),s({show:!0,msg:h("Tags refreshed","bit-integrations")})}else(u=o==null?void 0:o.data)!=null&&u.data||!o.success&&typeof o.data=="string"?s({show:!0,msg:`${h("Tags refresh failed Cause:","bit-integrations")}${o.data.data||o.data}. ${h("please try again","bit-integrations")}`}):s({show:!0,msg:h("Tags refresh failed. please try again","bit-integrations")});i(!1)}).catch(()=>i(!1))},ae=(t,a,n,l,i)=>{l(!0);const s={formID:t,dataCenter:a.dataCenter,clientId:a.clientId,clientSecret:a.clientSecret,tokenDetails:a.tokenDetails};k(s,"zcrm_get_users").then(e=>{if(e!=null&&e.success){const d=f({},a);d.default.crmOwner=e.data.users,e.data.tokenDetails&&(d.tokenDetails=e.data.tokenDetails),n(f({},d)),i({show:!0,msg:h("Owners refreshed","bit-integrations")})}else i({show:!0,msg:h("Owners refresh failed. please try again","bit-integrations")});l(!1)}).catch(()=>l(!1))},se=(t,a,n,l,i)=>{const s=t===0?a.module:a.relatedlists[t-1].module;if(!s)return;l(!0);const e={module:s,dataCenter:a.dataCenter,clientId:a.clientId,clientSecret:a.clientSecret,tokenDetails:a.tokenDetails};k(e,"zcrm_get_assignment_rules").then(d=>{if(d!=null&&d.success){const o=f({},a);o.default.assignmentRules||(o.default.assignmentRules={}),d.data.tokenDetails&&(o.tokenDetails=d.data.tokenDetails),o.default.assignmentRules[s]=f({},d.data.assignmentRules),n(f({},o)),i({show:!0,msg:h("Assignment Rules refreshed","bit-integrations")})}else i({show:!0,msg:h("Assignment Rules refresh failed. please try again","bit-integrations")});l(!1)}).catch(()=>l(!1))},D=(t,a,n)=>{const l=t===0?a.module:a.relatedlists[t-1].module,i=t===0?a.layout:a.relatedlists[t-1].layout;return n?a.default.layouts[l][i].requiredFileUploadFields.length>0?a.default.layouts[l][i].requiredFileUploadFields.map(s=>({formField:"",zohoFormField:s})):[{formField:"",zohoFormField:""}]:a.default.layouts[l][i].required.length>0?a.default.layouts[l][i].required.map(s=>({formField:"",zohoFormField:s})):[{formField:"",zohoFormField:""}]},le=t=>{const a=t!=null&&t.field_map?t.field_map.filter(s=>{var e,d,o,u;return!s.formField&&s.zohoFormField&&((u=(o=(d=(e=t==null?void 0:t.default)==null?void 0:e.layouts)==null?void 0:d[t.module])==null?void 0:o[t.layout])==null?void 0:u.required.indexOf(s.zohoFormField))!==-1}):[],n=t!=null&&t.upload_field_map?t.upload_field_map.filter(s=>!s.formField&&s.zohoFormField&&t.default.layouts[t.module][t.layout].requiredFileUploadFields.indexOf(s.zohoFormField)!==-1):[],l=t.relatedlists.map(s=>s.field_map.filter(e=>!e.formField&&e.zohoFormField)),i=t.relatedlists.map(s=>s.upload_field_map.filter(e=>!e.formField&&e.zohoFormField));return!(a.length>0||n.length>0||l.some(s=>s.length)||i.some(s=>s.length))};export{X as a,I as b,le as c,ae as d,C as e,b as f,x as g,T as h,L as i,ee as j,H as k,K as l,te as m,Y as n,se as r,Q as s};
